<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>AviDaVinci's Limited Event!</title>
        <script type="text/javascript" src="/AviDaVinci-s-Limited-Event/script.js" defer></script>
        <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
        <script src="https://supereggbert.github.io/aframe-htmlembed-component/dist/build.js"></script>
        <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>

        <audio id="qAccept">
            <source src="resources/FFXIV_Quest_Accepted.mp3" type="audio/mp3">
        </audio>
        <audio id="qDecline">
            <source src="resources/FFXIV_Cancel.mp3" type="audio/mp3">
        </audio>
        <audio id="mOver">
            <source src="resources/FFXIV_Switch_Target.mp3" type="audio/mp3">
        </audio>
        <audio id="buttClick">
            <source src="resources/FFXIV_Confirm.mp3" type="audio/mp3">
        </audio>
        <audio id="qComplete">
            <source src="resources/FFXIV_Quest_Complete.mp3" type="audio/mp3">
        </audio>
    </head>

    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #QWindow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
        }
        #QWindow img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
        }
    </style>

    <script>
        var aEL;
        var dEL;
        AFRAME.registerComponent('accept', {
            init: function () {
            var data = this.data;
            var el = this.el;

            function onMEnterA(){
                mOverSFX();
            }
            aEL = onMEnterA();

            el.addEventListener('mouseenter', onMEnterA);

            el.addEventListener('click', function () {
                buttAccept();
                // setTimeout(openForms, 5500);
            });
            }
        });

        AFRAME.registerComponent('decline', {
            init: function () {
            var data = this.data;
            var el = this.el;

            function onMEnterD(){
                mOverSFX();
            }
            dEL = onMEnterD();

            el.addEventListener('mouseenter', onMEnterD);

            el.addEventListener('click', function () {
                declineQuest();
                var qw = document.querySelector("#qwImage");
                qw.setAttribute("visible", false);
                compRemoval();
                el.removeEventListener('mouseenter', onMEnterD);
                var acceptButton = document.querySelector("#accept");
                // var listeningFunc = acceptButton.components["accept"].listeningFunc;
                acceptButton.removeEventListener("mouseenter", aEL);
            });
            }
        });

        AFRAME.registerComponent('shake', {
        init: function () {
            window.addEventListener('devicemotion', this.onDeviceMotion.bind(this));
        },
        onDeviceMotion: function (event) {
            // Get the acceleration including gravity from the DeviceMotionEvent
            var acceleration = event.accelerationIncludingGravity;

            // Calculate the total acceleration
            var totalAcceleration = Math.sqrt(
            Math.pow(acceleration.x, 2) +
            Math.pow(acceleration.y, 2) +
            Math.pow(acceleration.z, 2)
            );

            // Check if the total acceleration is above a certain threshold
            if (totalAcceleration > 25) {
            // Trigger an event or update the scene here
            var qw = document.querySelector("#qwImage");
                qw.setAttribute("visible", true);
                compAcquisition();
            }
        }
        });
    </script>

    <body>
        <!-- <div id="QWindow">
            <img src="resources/questWindow.png">
        </div> -->
        <a-scene 
         shake
         vr-mode-ui="enabled: false"
         cursor="rayOrigin: mouse; fuse: false" 
         raycaster="objects: .raycastable">
            <a-assets>
                <img id="QWindow" src="resources/questWindow.png">
            </a-assets>
            <a-sky color="#1B1B1B"></a-sky>
            <a-image id="qwImage" src="#QWindow" width="0.84" height="1" look-at="#camera">
                <a-plane accept id="accept" 
                class="raycastable"
                transparent="true"
                opacity="0.5"
                height="0.035" width="0.225" 
                position="-0.150, -0.325, 0.001" 
                material="color: #ff000000; side: double; wireframe: true"></a-plane>

                <a-plane decline id="decline" 
                class="raycastable"
                transparent="true"
                opacity="0.5"
                height="0.035" width="0.225" 
                position="0.150, -0.325, 0.001" 
                material="color: #ff000000; side: double; wireframe: true"></a-plane>
            </a-image>

            <a-entity id="rig" position="0 -1.6 1">
                <a-camera look-controls wasd-controls-enabled="false" id="camera"></a-camera>
            </a-entity>
        </a-scene>
    </body>
</html>